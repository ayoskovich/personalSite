---
title: Data Cleaning Dump
author: R package build
date: '2021-09-24'
slug: []
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2021-09-24T23:46:00-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
draft: true
editor_options: 
  chunk_output_type: console
---

### Find iris data on using the `pins` package.

[pins](https://pins.rstudio.com)

```{r}
library(tidyverse)
library(pins)

pin_find('iris', board='packages')
```

### Retrieve the actual dataset

```{r}
pin_get('BSDA/Irises')
```

### Mutating columns

When converting columns to different data types, I usually use `mutate_at` instead of `mutate`. I think it's faster and easier to change if I need to apply the same transformation to more columns. Here I can use `matches` inside of `across` to search using a regular expression.
```{r}
library(MASS)

data('ChickWeight')

ChickWeight %>%
  mutate(across(matches('Time'), as.integer))
```

Rather than doing something like this:

```{r}
ChickWeight %>%
  mutate(Time = as.integer(Time)) %>%
  glimpse()
```

### c_across and rowwise
```{r}
df <- tibble(x = 1:2, y = 3:4, z = 5:6)

# This
df %>% 
  mutate(m = mean(c(x, y, z)))

# As compared to this
df %>% 
  rowwise() %>%
  mutate(m = mean(c(x, y, z)))
```

```{r}
df <- tibble(name = c("Mara", "Hadley"), x = 1:2, y = 3:4, z = 5:6)

# Return the whole dataframe
df %>%
  rowwise() %>%
  mutate(m = sum(c_across(c(x, y, z))))

  # This is faster
  # mutate(m = rowSums(across(c(x, y, z))))


# Just return the summaries
df %>%
  rowwise() %>%
  summarise(m = sum(c_across(c(x, y, z))))
```


```{r}
df <- tibble(
  x = list(1, 2:3, 4:6)
)

df

df %>%
  mutate(foo = lengths(x))

df %>%
  mutate(foo = lengths(x)) %>%
  mutate(bar = sapply(x, length)) %>%
  mutate(baz = sapply(x, length)) %>%
  mutate(foob = purrr::map_int(x, length)) %>%
  # Or use rowwise and just do length() normally
  rowwise() %>%
  mutate(final = length(x))
```

## purrr
```{r}
df <- tibble(
  grp = sample(c('A', 'B'), size=10, replace=TRUE),
  a = rnorm(10),
  b = rnorm(10),
  c = rnorm(10),
  d = rnorm(10)
)

df %>% 
  map_dbl(mean)

mtcars %>%
  map(~ lm(mpg ~ wt, data=.)) 
  
mtcars %>%
  split(.$cyl) %>%
  #map(function(df) lm(mpg ~ wt, data = df))
  map(~ lm(mpg ~ wt, data=.)) %>%
  map(summary) %>%
  #map_dbl(~.$r.squared) 
  map_dbl('r.squared')

# Get the average of each column
mtcars %>%
  map_dbl(mean)

# Type of each column
nycflights13::flights %>%
  map_chr(typeof)

# number of unique values in each column
iris %>%
  map_int(n_distinct)

iris %>%
  
# 10 random normals from mean -10, 0, and 10
c(-10, 0, 10) %>% map(~ rnorm(10, .))


sample_sizes <- c(5, 10, 15)
mus <- c(2, 8, 15)

map2(mus, sample_sizes, rnorm)

map2(mus, sample_sizes, ~rnorm(n=.y, mean=.x))
```

```{r}
map(
  c(1, 2, 4), 
  ~sample(c('A', 'B'), size=.x, replace=TRUE)
)

foo <- safely(log)
map(c(1, 10), foo) %>% str()

safe_log <- safely(log)
str(safe_log(10))

list(1, 10, "a") %>% map(safely(log))
```

