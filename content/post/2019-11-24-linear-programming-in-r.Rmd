---
title: Allocation Model in R
author: Anthony Yoskovich
date: '2019-11-24'
tags:
  - operations research
slug: linear-programming-in-r
editor_options:
  chunk_output_type: console
---


```{r Get packages, echo=FALSE, message=FALSE, warning=FALSE}
require(lpSolve)
```

# Summary
In this post I demonstrate how to solve an allocation problem using the `lpSolve` package in R. I would probably prefer using `AMPL` to solve LP problems due to its readable syntax and ease of scalability. When using `R`, it's easy to forget the underlying mathematical models that are being translated. However, with `AMPL` my brain feels more in the "math mode" (if that makes any sense lol). For unfamiliar readers, [here](https://www.me.utexas.edu/~jensen/ORMM/models/unit/linear/subunits/resource_allocation/index.html) is a good explanation of the allocation model.

### 1. Allocation Model

I'm going to skip over the contextual details of the problem and just provide the mathematical model. This problem comes from Example 4.1 of *Optimization in Operations Research (Rearden 2015)*.

$$
\begin{align}
  \max{} & \quad 2h_1 + 3h_2 + h_3 + 5h_4\\
  \\
  \text{s.t.} & \notag \\
  \\
  &\sum_{j=1}^{4} h_j = 30 \\
  &h_1 \ge h_j \quad &j = 2,...4\\
  &h_j \le 10 \quad &j = 1,...4 \\
  &h_j \ge 0 \quad &j = 1,...4 \\
\end{align}
$$

$h_j \equiv$ Number of hours $h$ spent studying the $j$th subject.

It immediately becomes apparent that each of the constraints are not explicitly written out. Instead, a few are written using the for all notation, something that `lpSolve` doesn't support. 

Translating the constraints into a format readily usable by `lpSolve` is a tad bit tedious but I'll discuss this more later on. First I'll define the coefficients for the objective function.
```{r Set coefficients}
coeff <- c(2, 3, 1, 5)
```

Now I create the constraint matrix (this is where some translation is needed to use `lpSolve`)
```{r Create matrix}
A <- matrix(c(1, 1, 1, 1, # Sum to 30
              
              1, -1, 0, 0, # h_1 is greatest
              1, 0, -1, 0,
              1, 0, 0, -1,
              
              1, 0, 0, 0, # max of 10
              0, 1, 0, 0,
              0, 0, 1, 0,
              0, 0, 0, 1,
              
              1, 0, 0, 0, # non negativity
              0, 1, 0, 0,
              0, 0, 1, 0,
              0, 0, 0, 1),
            ncol=4,
            byrow=TRUE)
```

Create the RHS for the constraints and define the directions.
```{r RHS}
RHS <- c(30, # Sum to 30
         
         0, # h_1 is greatest
         0, 
         0,
         
         10, # max of 10
         10, 
         10,
         10,
         
         0, # non negativity
         0, 
         0,
         0)

directions <- c('=', # Sum to 30
                
                '>=', # h_1 is greatest
                '>=',
                '>=',
                
                '<=', # max of 10
                '<=',
                '<=',
                '<=',
                
                '>=', # non negativity
                '>=',
                '>=',
                '>=')
```

Now use the `lp()` function to solve the model.
```{r Solve}
optimum <-  lp(direction="min",
               objective.in = coeff,
               const.mat = A,
               const.dir = directions,
               const.rhs = RHS,
               all.int = T) # All integers

optimum$solution
```

Inputing this simple model was tedious. I could have cleaned up the constraint directions by using `rep()` function or something, but I don't see that being something that I could ever get used to. 

# Final Note
`AMPL` is another (although not free) way to solve these types of problems and offers a significantly more elegant syntax. For example, the below chunk solves the same problem and is very extensible right out of the box. I may break down some OR problems in `AMPL` in future posts.

```
model;

set subjects;
param productivity{subjects};

var hours{subjects} >= 0;

maximize TotalScore:
    sum{i in subjects} hours[i]*productivity[i];
    
subject to
    totalHours: 
        sum{i in subjects} hours[i] = 30;
    
    maxTen {i in subjects}:
        hours[i] <= 10;

data;

set subjects := s1 s2 s3 s4;

param: productivity :=
    s1   2
    s2   3
    s3   1
    s4   5
;

solve;
display hours;
```
