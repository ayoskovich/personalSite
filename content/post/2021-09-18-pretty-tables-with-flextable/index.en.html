---
title: Data Wrangling Doodles
author: R package build
date: '2021-09-18'
slug: []
categories: []
tags: 
  - r
subtitle: ''
summary: 'Using `flextable`, `janitor`, `waldo`, and `forcats`'
authors: []
lastmod: '2021-09-18T09:41:50-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
editor_options: 
  chunk_output_type: console
draft: false
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/tabwid/tabwid.css" rel="stylesheet" />


<p>This post shows 3 data cleaning things I’ve been doing quite a bit lately:</p>
<ol style="list-style-type: decimal">
<li>Building and formatting tables</li>
<li>Comparing dataset columns / types</li>
<li>Combining categories</li>
</ol>
<hr />
<p><code>janitor</code> and <code>flextable</code> are really great for building and formatting tables:</p>
<pre class="r"><code>mtcars %&gt;%
  tibble() %&gt;%
  janitor::tabyl(cyl) %&gt;%
  janitor::adorn_pct_formatting(digits=0) %&gt;%
  flextable() %&gt;%
  theme_booktabs() %&gt;%
  set_header_labels(
    cyl = &#39;Cylinder&#39;,
    n = &#39;# Obs&#39;,
    percent = &#39;Percent&#39;
  ) %&gt;%
  add_header_row(values=c(&#39;Summary Table&#39;), colwidths = c(3)) %&gt;%
  align(align=&#39;center&#39;, part=&#39;all&#39;) %&gt;%
  bg(bg = &#39;blue&#39;, part=&#39;header&#39;) %&gt;%
  color(color=&#39;white&#39;, part=&#39;header&#39;)</code></pre>
<template id="ea106d59-7941-4bf3-8ed4-990340365e7c"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-caa0900c{}.cl-ca9ad73e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-ca9ad73f{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ca9aeac6{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ca9b11c2{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ca9b11c3{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ca9b11c4{width:54pt;background-color:rgba(0, 0, 255, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-caa0900c'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="3"class="cl-ca9b11c4"><p class="cl-ca9aeac6"><span class="cl-ca9ad73e">Summary Table</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ca9b11c4"><p class="cl-ca9aeac6"><span class="cl-ca9ad73e">Cylinder</span></p></td><td class="cl-ca9b11c4"><p class="cl-ca9aeac6"><span class="cl-ca9ad73e"># Obs</span></p></td><td class="cl-ca9b11c4"><p class="cl-ca9aeac6"><span class="cl-ca9ad73e">Percent</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">4</span></p></td><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">11</span></p></td><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">34%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">6</span></p></td><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">7</span></p></td><td class="cl-ca9b11c2"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">22%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ca9b11c3"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">8</span></p></td><td class="cl-ca9b11c3"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">14</span></p></td><td class="cl-ca9b11c3"><p class="cl-ca9aeac6"><span class="cl-ca9ad73f">44%</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="5b13de0b-77ab-4b82-8512-db791c7fdb7e"></div>
<script>
var dest = document.getElementById("5b13de0b-77ab-4b82-8512-db791c7fdb7e");
var template = document.getElementById("ea106d59-7941-4bf3-8ed4-990340365e7c");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<hr />
<p>The <code>compare</code> function from <code>waldo</code> makes joining and concatenating data that isn’t exactly the same less painful:</p>
<template id="f162d572-749b-46e0-9597-2a9a58b8f2e2"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-cab18010{}.cl-caabb3b0{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-caabc72e{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-caabee3e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caabee3f{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caabee40{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-cab18010'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="2"class="cl-caabee40"><p class="cl-caabc72e"><span class="cl-caabb3b0">base</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-caabee40"><p class="cl-caabc72e"><span class="cl-caabb3b0">name</span></p></td><td class="cl-caabee40"><p class="cl-caabc72e"><span class="cl-caabb3b0">height</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-caabee3e"><p class="cl-caabc72e"><span class="cl-caabb3b0">tony</span></p></td><td class="cl-caabee3e"><p class="cl-caabc72e"><span class="cl-caabb3b0">15</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-caabee3f"><p class="cl-caabc72e"><span class="cl-caabb3b0">bob</span></p></td><td class="cl-caabee3f"><p class="cl-caabc72e"><span class="cl-caabb3b0">13</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="addc6d52-0e48-4e91-971d-51b59157ef3c"></div>
<script>
var dest = document.getElementById("addc6d52-0e48-4e91-971d-51b59157ef3c");
var template = document.getElementById("f162d572-749b-46e0-9597-2a9a58b8f2e2");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<template id="be2ac37c-7a94-4cc5-850d-64feef7164d7"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-cabe16cc{}.cl-cab8fa34{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-cab8fa35{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-cab92144{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cab92145{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cab92146{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-cabe16cc'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="2"class="cl-cab92146"><p class="cl-cab8fa35"><span class="cl-cab8fa34">aug</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-cab92146"><p class="cl-cab8fa35"><span class="cl-cab8fa34">NAME</span></p></td><td class="cl-cab92146"><p class="cl-cab8fa35"><span class="cl-cab8fa34">height</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-cab92144"><p class="cl-cab8fa35"><span class="cl-cab8fa34">tony</span></p></td><td class="cl-cab92144"><p class="cl-cab8fa35"><span class="cl-cab8fa34">15</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-cab92145"><p class="cl-cab8fa35"><span class="cl-cab8fa34">bob</span></p></td><td class="cl-cab92145"><p class="cl-cab8fa35"><span class="cl-cab8fa34">13</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="1ecf0ea8-ccab-4092-9062-97eabfadd84e"></div>
<script>
var dest = document.getElementById("1ecf0ea8-ccab-4092-9062-97eabfadd84e");
var template = document.getElementById("be2ac37c-7a94-4cc5-850d-64feef7164d7");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre><code>## `names(base)`: &quot;name&quot; &quot;height&quot;
## `names(aug)`:  &quot;NAME&quot; &quot;height&quot;
## 
## `base$name` is a character vector (&#39;tony&#39;, &#39;bob&#39;)
## `aug$name` is absent
## 
## `base$height` is a character vector (&#39;15&#39;, &#39;13&#39;)
## `aug$height` is a double vector (15, 13)
## 
## `base$NAME` is absent
## `aug$NAME` is a character vector (&#39;tony&#39;, &#39;bob&#39;)</code></pre>
<p>There is also a function in <code>janitor</code> that does something similar</p>
<pre class="r"><code>janitor::compare_df_cols(
  base,
  aug
) %&gt;% 
  flextable() %&gt;%
  align(align=&#39;center&#39;, part=&#39;all&#39;)</code></pre>
<template id="83b8cf41-32e0-4836-ac16-a9dfb4de92ae"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-cae51358{}.cl-cadef8d8{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-cadf0c6a{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-cadf1fe8{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cadf1fe9{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cadf1fea{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-cae51358'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-cadf1fea"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">column_name</span></p></td><td class="cl-cadf1fea"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">base</span></p></td><td class="cl-cadf1fea"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">aug</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">height</span></p></td><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">character</span></p></td><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">numeric</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">name</span></p></td><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">character</span></p></td><td class="cl-cadf1fe8"><p class="cl-cadf0c6a"><span class="cl-cadef8d8"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-cadf1fe9"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">NAME</span></p></td><td class="cl-cadf1fe9"><p class="cl-cadf0c6a"><span class="cl-cadef8d8"></span></p></td><td class="cl-cadf1fe9"><p class="cl-cadf0c6a"><span class="cl-cadef8d8">character</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="5795ddd1-59d4-40e5-aeb5-1075ab326ec2"></div>
<script>
var dest = document.getElementById("5795ddd1-59d4-40e5-aeb5-1075ab326ec2");
var template = document.getElementById("83b8cf41-32e0-4836-ac16-a9dfb4de92ae");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<hr />
<p>Combining factors with <code>forcats</code> is really handy when the categories are at different levels. For example, combining the ‘Cats’ and ‘Dogs’ categories in one data source to match the ‘Animals’ category in another.</p>
<p>I can go from this:</p>
<template id="d3ccf503-5921-49fd-a8cf-b9d0da3aeab8"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-caf839d8{}.cl-caf28100{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-caf28101{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-caf2a810{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caf2a811{width:54pt;background-color:rgba(237, 214, 149, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caf2a812{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caf2a813{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-caf839d8'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-caf2a813"><p class="cl-caf28101"><span class="cl-caf28100">Category</span></p></td><td class="cl-caf2a813"><p class="cl-caf28101"><span class="cl-caf28100">pct</span></p></td><td class="cl-caf2a813"><p class="cl-caf28101"><span class="cl-caf28100">dat_src</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-caf2a811"><p class="cl-caf28101"><span class="cl-caf28100">Cats</span></p></td><td class="cl-caf2a810"><p class="cl-caf28101"><span class="cl-caf28100">0.15</span></p></td><td class="cl-caf2a810"><p class="cl-caf28101"><span class="cl-caf28100">A</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-caf2a811"><p class="cl-caf28101"><span class="cl-caf28100">Dogs</span></p></td><td class="cl-caf2a810"><p class="cl-caf28101"><span class="cl-caf28100">0.40</span></p></td><td class="cl-caf2a810"><p class="cl-caf28101"><span class="cl-caf28100">A</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-caf2a812"><p class="cl-caf28101"><span class="cl-caf28100">Humans</span></p></td><td class="cl-caf2a812"><p class="cl-caf28101"><span class="cl-caf28100">0.45</span></p></td><td class="cl-caf2a812"><p class="cl-caf28101"><span class="cl-caf28100">A</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="91a8f2fd-f6e2-4976-a4d1-0743f3471af0"></div>
<script>
var dest = document.getElementById("91a8f2fd-f6e2-4976-a4d1-0743f3471af0");
var template = document.getElementById("d3ccf503-5921-49fd-a8cf-b9d0da3aeab8");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<template id="2995c19b-13dd-437d-bd5d-1d5b8ea21b71"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-cb04d08a{}.cl-caff17d0{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-caff17d1{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-caff3eae{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caff3eaf{width:54pt;background-color:rgba(237, 214, 149, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caff3eb0{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-caff3eb1{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-cb04d08a'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-caff3eb1"><p class="cl-caff17d1"><span class="cl-caff17d0">Category</span></p></td><td class="cl-caff3eb1"><p class="cl-caff17d1"><span class="cl-caff17d0">pct</span></p></td><td class="cl-caff3eb1"><p class="cl-caff17d1"><span class="cl-caff17d0">dat_src</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-caff3eaf"><p class="cl-caff17d1"><span class="cl-caff17d0">Animals</span></p></td><td class="cl-caff3eae"><p class="cl-caff17d1"><span class="cl-caff17d0">0.25</span></p></td><td class="cl-caff3eae"><p class="cl-caff17d1"><span class="cl-caff17d0">B</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-caff3eb0"><p class="cl-caff17d1"><span class="cl-caff17d0">Humans</span></p></td><td class="cl-caff3eb0"><p class="cl-caff17d1"><span class="cl-caff17d0">0.75</span></p></td><td class="cl-caff3eb0"><p class="cl-caff17d1"><span class="cl-caff17d0">B</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="f1e0046d-dfa4-4e1a-a6b8-3ab105d0320f"></div>
<script>
var dest = document.getElementById("f1e0046d-dfa4-4e1a-a6b8-3ab105d0320f");
var template = document.getElementById("2995c19b-13dd-437d-bd5d-1d5b8ea21b71");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>to this</p>
<template id="3adc6659-c4f8-4a2f-b3e1-86161c63e557"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-cb185894{}.cl-cb126538{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-cb1278ac{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-cb129fc6{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cb129fc7{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-cb129fc8{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-cb185894'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-cb129fc8"><p class="cl-cb1278ac"><span class="cl-cb126538">Category</span></p></td><td class="cl-cb129fc8"><p class="cl-cb1278ac"><span class="cl-cb126538">A</span></p></td><td class="cl-cb129fc8"><p class="cl-cb1278ac"><span class="cl-cb126538">B</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-cb129fc6"><p class="cl-cb1278ac"><span class="cl-cb126538">Animals</span></p></td><td class="cl-cb129fc6"><p class="cl-cb1278ac"><span class="cl-cb126538">0.55</span></p></td><td class="cl-cb129fc6"><p class="cl-cb1278ac"><span class="cl-cb126538">0.25</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-cb129fc7"><p class="cl-cb1278ac"><span class="cl-cb126538">Humans</span></p></td><td class="cl-cb129fc7"><p class="cl-cb1278ac"><span class="cl-cb126538">0.45</span></p></td><td class="cl-cb129fc7"><p class="cl-cb1278ac"><span class="cl-cb126538">0.75</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="285b6874-0540-46ca-8712-278543b4ca4c"></div>
<script>
var dest = document.getElementById("285b6874-0540-46ca-8712-278543b4ca4c");
var template = document.getElementById("3adc6659-c4f8-4a2f-b3e1-86161c63e557");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>by doing this:</p>
<pre class="r"><code>a %&gt;%
  mutate_at(c(&#39;Category&#39;), as_factor) %&gt;%
  mutate_at(c(&#39;Category&#39;), 
            ~ fct_collapse(.x, Animals = c(&#39;Cats&#39;, &#39;Dogs&#39;))) %&gt;%
  group_by(Category, dat_src) %&gt;%
  summarise(pct = sum(pct)) %&gt;% 
  ungroup() %&gt;%
  bind_rows(b) %&gt;%
  pivot_wider(
    names_from=dat_src,
    values_from=pct
  ) %&gt;%
  flextable()</code></pre>
