---
title: Data Wrangling Doodles
author: R package build
date: '2021-09-18'
slug: []
categories: []
tags: []
subtitle: ''
summary: 'Using `flextable`, `janitor`, `waldo`, and `forcats`'
authors: []
lastmod: '2021-09-18T09:41:50-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
editor_options: 
  chunk_output_type: console
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/tabwid/tabwid.css" rel="stylesheet" />


<p>This post shows 3 data cleaning things I’ve been doing quite a bit lately:</p>
<ol style="list-style-type: decimal">
<li>Building and formatting tables</li>
<li>Comparing dataset columns / types</li>
<li>Combining categories</li>
</ol>
<hr />
<p><code>janitor</code> and <code>flextable</code> are really great for building and formatting tables:</p>
<pre class="r"><code>mtcars %&gt;%
  tibble() %&gt;%
  janitor::tabyl(cyl) %&gt;%
  janitor::adorn_pct_formatting(digits=0) %&gt;%
  flextable() %&gt;%
  theme_booktabs() %&gt;%
  set_header_labels(
    cyl = &#39;Cylinder&#39;,
    n = &#39;# Obs&#39;,
    percent = &#39;Percent&#39;
  ) %&gt;%
  add_header_row(values=c(&#39;Summary Table&#39;), colwidths = c(3)) %&gt;%
  align(align=&#39;center&#39;, part=&#39;all&#39;) %&gt;%
  bg(bg = &#39;blue&#39;, part=&#39;header&#39;) %&gt;%
  color(color=&#39;white&#39;, part=&#39;header&#39;)</code></pre>
<template id="7a825a47-4003-4276-a97d-865b607edf31"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a702b938{}.cl-a6fc1204{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-a6fc124a{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a6fc2ff0{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6fc692a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fc6948{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fc6949{width:54pt;background-color:rgba(0, 0, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fc6952{width:54pt;background-color:rgba(0, 0, 255, 1.00);vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a702b938'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="3"class="cl-a6fc6949"><p class="cl-a6fc2ff0"><span class="cl-a6fc1204">Summary Table</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6fc6952"><p class="cl-a6fc2ff0"><span class="cl-a6fc1204">Cylinder</span></p></td><td class="cl-a6fc6952"><p class="cl-a6fc2ff0"><span class="cl-a6fc1204"># Obs</span></p></td><td class="cl-a6fc6952"><p class="cl-a6fc2ff0"><span class="cl-a6fc1204">Percent</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">4</span></p></td><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">11</span></p></td><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">34%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">6</span></p></td><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">7</span></p></td><td class="cl-a6fc692a"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">22%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6fc6948"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">8</span></p></td><td class="cl-a6fc6948"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">14</span></p></td><td class="cl-a6fc6948"><p class="cl-a6fc2ff0"><span class="cl-a6fc124a">44%</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="b417c008-cf7f-4fb9-b3fe-435745b70e9f"></div>
<script>
var dest = document.getElementById("b417c008-cf7f-4fb9-b3fe-435745b70e9f");
var template = document.getElementById("7a825a47-4003-4276-a97d-865b607edf31");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<hr />
<p>The <code>compare</code> function from <code>waldo</code> makes joining and concatenating data that isn’t exactly the same less painful:</p>
<template id="f05d5379-262e-4efc-96b7-05040f186ca3"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a711630c{}.cl-a70c9fc0{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a70cad8a{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a70cd08a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a70cd09e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a70cd0a8{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a70cd0b2{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a711630c'><thead><tr style="overflow-wrap:break-word;"><td  colspan="2"class="cl-a70cd0a8"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">base</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a70cd0b2"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">name</span></p></td><td class="cl-a70cd0b2"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">height</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a70cd08a"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">tony</span></p></td><td class="cl-a70cd08a"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">15</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a70cd09e"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">bob</span></p></td><td class="cl-a70cd09e"><p class="cl-a70cad8a"><span class="cl-a70c9fc0">13</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="8a8c2ded-87a1-4036-bf06-96f022642349"></div>
<script>
var dest = document.getElementById("8a8c2ded-87a1-4036-bf06-96f022642349");
var template = document.getElementById("f05d5379-262e-4efc-96b7-05040f186ca3");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<template id="749d0965-ae6c-4d02-b187-6e492e1d6653"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a71ef288{}.cl-a71a2816{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a71a39d2{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a71a5f3e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a71a5f52{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a71a5f5c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a71a5f66{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a71ef288'><thead><tr style="overflow-wrap:break-word;"><td  colspan="2"class="cl-a71a5f5c"><p class="cl-a71a39d2"><span class="cl-a71a2816">aug</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a71a5f66"><p class="cl-a71a39d2"><span class="cl-a71a2816">NAME</span></p></td><td class="cl-a71a5f66"><p class="cl-a71a39d2"><span class="cl-a71a2816">height</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a71a5f3e"><p class="cl-a71a39d2"><span class="cl-a71a2816">tony</span></p></td><td class="cl-a71a5f3e"><p class="cl-a71a39d2"><span class="cl-a71a2816">15</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a71a5f52"><p class="cl-a71a39d2"><span class="cl-a71a2816">bob</span></p></td><td class="cl-a71a5f52"><p class="cl-a71a39d2"><span class="cl-a71a2816">13</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="86ea19d3-647e-40ff-97e7-3c4031579f10"></div>
<script>
var dest = document.getElementById("86ea19d3-647e-40ff-97e7-3c4031579f10");
var template = document.getElementById("749d0965-ae6c-4d02-b187-6e492e1d6653");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre><code>## `names(base)`: &quot;name&quot; &quot;height&quot;
## `names(aug)`:  &quot;NAME&quot; &quot;height&quot;
## 
## `base$name` is a character vector (&#39;tony&#39;, &#39;bob&#39;)
## `aug$name` is absent
## 
## `base$height` is a character vector (&#39;15&#39;, &#39;13&#39;)
## `aug$height` is a double vector (15, 13)
## 
## `base$NAME` is absent
## `aug$NAME` is a character vector (&#39;tony&#39;, &#39;bob&#39;)</code></pre>
<p>There is also a function in <code>janitor</code> that does something similar</p>
<pre class="r"><code>janitor::compare_df_cols(
  base,
  aug
) %&gt;% 
  flextable() %&gt;%
  align(align=&#39;center&#39;, part=&#39;all&#39;)</code></pre>
<template id="0bbe295d-8767-4261-bb3e-bca6d5cddf9b"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a73dc244{}.cl-a738ece2{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a738f9ee{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a7391cbc{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7391cda{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7391ce4{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a73dc244'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-a7391ce4"><p class="cl-a738f9ee"><span class="cl-a738ece2">column_name</span></p></td><td class="cl-a7391ce4"><p class="cl-a738f9ee"><span class="cl-a738ece2">base</span></p></td><td class="cl-a7391ce4"><p class="cl-a738f9ee"><span class="cl-a738ece2">aug</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2">height</span></p></td><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2">character</span></p></td><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2">numeric</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2">name</span></p></td><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2">character</span></p></td><td class="cl-a7391cbc"><p class="cl-a738f9ee"><span class="cl-a738ece2"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a7391cda"><p class="cl-a738f9ee"><span class="cl-a738ece2">NAME</span></p></td><td class="cl-a7391cda"><p class="cl-a738f9ee"><span class="cl-a738ece2"></span></p></td><td class="cl-a7391cda"><p class="cl-a738f9ee"><span class="cl-a738ece2">character</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="b4e3f198-74b9-4354-8e91-349622b88138"></div>
<script>
var dest = document.getElementById("b4e3f198-74b9-4354-8e91-349622b88138");
var template = document.getElementById("0bbe295d-8767-4261-bb3e-bca6d5cddf9b");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<hr />
<p>Combining factors with <code>forcats</code> is really handy when the categories are at different levels. For example, combining the ‘Cats’ and ‘Dogs’ categories in one data source to match the ‘Animals’ category in another.</p>
<p>I can go from this:</p>
<template id="7a49fdbb-502f-4a4b-a5ff-3220ecd91ac9"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a74cae80{}.cl-a747c1fe{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a747cf3c{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a747f282{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a747f296{width:54pt;background-color:rgba(237, 214, 149, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a747f2a0{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a747f2aa{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a74cae80'><thead><tr style="overflow-wrap:break-word;"><td class="cl-a747f2aa"><p class="cl-a747cf3c"><span class="cl-a747c1fe">Category</span></p></td><td class="cl-a747f2aa"><p class="cl-a747cf3c"><span class="cl-a747c1fe">pct</span></p></td><td class="cl-a747f2aa"><p class="cl-a747cf3c"><span class="cl-a747c1fe">dat_src</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a747f296"><p class="cl-a747cf3c"><span class="cl-a747c1fe">Cats</span></p></td><td class="cl-a747f282"><p class="cl-a747cf3c"><span class="cl-a747c1fe">0.15</span></p></td><td class="cl-a747f282"><p class="cl-a747cf3c"><span class="cl-a747c1fe">A</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a747f296"><p class="cl-a747cf3c"><span class="cl-a747c1fe">Dogs</span></p></td><td class="cl-a747f282"><p class="cl-a747cf3c"><span class="cl-a747c1fe">0.40</span></p></td><td class="cl-a747f282"><p class="cl-a747cf3c"><span class="cl-a747c1fe">A</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a747f2a0"><p class="cl-a747cf3c"><span class="cl-a747c1fe">Humans</span></p></td><td class="cl-a747f2a0"><p class="cl-a747cf3c"><span class="cl-a747c1fe">0.45</span></p></td><td class="cl-a747f2a0"><p class="cl-a747cf3c"><span class="cl-a747c1fe">A</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="53e46bf4-80a9-4d20-8095-cbf8bcc31e74"></div>
<script>
var dest = document.getElementById("53e46bf4-80a9-4d20-8095-cbf8bcc31e74");
var template = document.getElementById("7a49fdbb-502f-4a4b-a5ff-3220ecd91ac9");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<template id="f9bce288-155a-4110-9d02-30437c929664"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a759d52e{}.cl-a7551250{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a7551f84{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a75541e4{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a75541f8{width:54pt;background-color:rgba(237, 214, 149, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7554202{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a755420c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a759d52e'><thead><tr style="overflow-wrap:break-word;"><td class="cl-a755420c"><p class="cl-a7551f84"><span class="cl-a7551250">Category</span></p></td><td class="cl-a755420c"><p class="cl-a7551f84"><span class="cl-a7551250">pct</span></p></td><td class="cl-a755420c"><p class="cl-a7551f84"><span class="cl-a7551250">dat_src</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a75541f8"><p class="cl-a7551f84"><span class="cl-a7551250">Animals</span></p></td><td class="cl-a75541e4"><p class="cl-a7551f84"><span class="cl-a7551250">0.25</span></p></td><td class="cl-a75541e4"><p class="cl-a7551f84"><span class="cl-a7551250">B</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a7554202"><p class="cl-a7551f84"><span class="cl-a7551250">Humans</span></p></td><td class="cl-a7554202"><p class="cl-a7551f84"><span class="cl-a7551250">0.75</span></p></td><td class="cl-a7554202"><p class="cl-a7551f84"><span class="cl-a7551250">B</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="dcda3286-84da-4cea-9907-c3c29dbe3cd7"></div>
<script>
var dest = document.getElementById("dcda3286-84da-4cea-9907-c3c29dbe3cd7");
var template = document.getElementById("f9bce288-155a-4110-9d02-30437c929664");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>to this</p>
<template id="369f1eb0-b636-4ccb-87d1-1b5be3385889"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-a76b0d80{}.cl-a766303a{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a7663e4a{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a76661ea{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7666208{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a7666212{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-a76b0d80'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-a7666212"><p class="cl-a7663e4a"><span class="cl-a766303a">Category</span></p></td><td class="cl-a7666212"><p class="cl-a7663e4a"><span class="cl-a766303a">A</span></p></td><td class="cl-a7666212"><p class="cl-a7663e4a"><span class="cl-a766303a">B</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a76661ea"><p class="cl-a7663e4a"><span class="cl-a766303a">Animals</span></p></td><td class="cl-a76661ea"><p class="cl-a7663e4a"><span class="cl-a766303a">0.55</span></p></td><td class="cl-a76661ea"><p class="cl-a7663e4a"><span class="cl-a766303a">0.25</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a7666208"><p class="cl-a7663e4a"><span class="cl-a766303a">Humans</span></p></td><td class="cl-a7666208"><p class="cl-a7663e4a"><span class="cl-a766303a">0.45</span></p></td><td class="cl-a7666208"><p class="cl-a7663e4a"><span class="cl-a766303a">0.75</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="6d37c916-5583-4074-9d26-a81383e14cff"></div>
<script>
var dest = document.getElementById("6d37c916-5583-4074-9d26-a81383e14cff");
var template = document.getElementById("369f1eb0-b636-4ccb-87d1-1b5be3385889");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>by doing this:</p>
<pre class="r"><code>a %&gt;%
  mutate_at(c(&#39;Category&#39;), as_factor) %&gt;%
  mutate_at(c(&#39;Category&#39;), 
            ~ fct_collapse(.x, Animals = c(&#39;Cats&#39;, &#39;Dogs&#39;))) %&gt;%
  group_by(Category, dat_src) %&gt;%
  summarise(pct = sum(pct)) %&gt;% 
  ungroup() %&gt;%
  bind_rows(b) %&gt;%
  pivot_wider(
    names_from=dat_src,
    values_from=pct
  ) %&gt;%
  flextable()</code></pre>
