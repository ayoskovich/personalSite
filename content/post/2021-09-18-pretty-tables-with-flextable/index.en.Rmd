---
title: Making my life easier in R
author: R package build
date: '2021-09-18'
slug: []
categories: []
tags: []
subtitle: ''
summary: 'Using `flextable`, `janitor`, and `waldo`'
authors: []
lastmod: '2021-09-18T09:41:50-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
editor_options: 
  chunk_output_type: console
draft: true
---

There are a few things that I've been doing a lot.

- Formatting nice tables for word documents using 
  - [flextable](https://davidgohel.github.io/flextable/)
- Comparing dataframe columns before joining
- Computing 1, 2, and 3 way tables
- Lumping categories


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(flextable)
library(janitor)
library(waldo)
```

- Building and formatting nice tables

```{r echo=FALSE, message=FALSE, warning=FALSE}
mtcars %>%
  tibble() %>%
  tabyl(cyl) %>%
  adorn_pct_formatting(digits=0) %>%
  flextable() %>%
  theme_booktabs() %>%
  set_header_labels(
    cyl = 'Cylinder',
    n = '# Obs',
    percent = 'Percent'
  ) %>%
  add_header_row(values=c('Summary Table'), colwidths = c(3)) %>%
  align(align='center', part='all') %>%
  bg(bg = 'blue', part='header') %>%
  color(color='white', part='header')
```


- Comparing dataframes using `compare` from `waldo`

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mtcars %>%
  compare(mtcars %>% 
            rename(foo = mpg)
          ) %>%
  print()

COLS <- c('mpg', 'cyl', 'disp')
mtcars %>%
  head() %>%
  select(all_of(COLS)) %>%
  bind_cols(
    mtcars %>% 
      select(all_of(COLS)) %>%
      rename(foo = mpg) %>%
      head()
  ) %>%
  flextable()
```

- Wrangling categories with `forcats`

```{r, echo=FALSE, message=FALSE, warning=FALSE}
a <- tribble(
  ~Category, ~pct, ~dat_src,
  'Cats', .15,   'A',
  'Dogs', .40,   'A',
  'Humans', .45, 'A'
)

b <- tribble(
  ~Category, ~pct, ~dat_src,
  'Animals', .25, 'B',
  # Are humans animals? thinkingemoji.pg
  'Humans', .75, 'B'
)
```


So we start with these two, and I'd like to combine them into 1 table.

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
a %>% flextable() %>% flextable_to_rmd()
b %>% flextable() %>% flextable_to_rmd()
```

```{r}
a %>%
  mutate_at(c('Category'), as_factor) %>%
  mutate_at(c('Category'), ~ fct_collapse(.x, Animals = c('Cats', 'Dogs'))) %>%
  group_by(Category, dat_src) %>%
  summarise(pct = sum(pct)) %>% 
  ungroup() %>%
  bind_rows(b) %>%
  pivot_wider(
    names_from=dat_src,
    values_from=pct
  ) %>%
  flextable() %>%
  add_header_row(values=c('', 'Data Source'), colwidths = c(1, 2)) %>%
  theme_box() %>%
  align(align='center', part='all')
```
